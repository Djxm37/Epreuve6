<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panneau de Contr√¥le - √âpreuve 6</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div class="logs-interface-container">

        <section id="log-decrypt-challenge" style="padding: 0;">
            <h2 style="color: var(--color-accent-bleu); padding: 20px 20px 0 20px;">
                Logs Syst√®me Corrompus üïµÔ∏è‚Äç‚ôÄÔ∏è
            </h2>
            <p style="color: var(--color-text-light); padding: 0 20px 20px 20px;">
                La DSIN demande de d√©crypter les logs pour identifier les d√©g√¢ts.
            </p>

            <div class="logs-interface-3-cols">

                <div id="logs-sidebar" class="interface-column sidebar">
                    <h3 style="color: var(--color-accent-rose); border-bottom: 1px solid var(--color-accent-bleu); padding-bottom: 10px;">LOGS</h3>
                    <ul>
                        <li><a href="#" id="nav-logs" class="active-link" data-target="log-display-area">Logs R√©seau & Syst√®me</a></li>
                        <li><a href="#" id="nav-reseau" data-target="flag-validation-challenge">R√©seau</a></li> 
                        <li><a href="#">Archives (Non accessible)</a></li>
                    </ul>
                </div>

                <div id="logs-list-area" class="interface-column list-area">
                    <h3 style="color: var(--color-accent-bleu);">Liste des √âv√©nements</h3>
                    <table id="logs-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Horodatage</th>
                                <th>Type</th>
                            </tr>
                        </thead>
                        <tbody id="logs-table-body">
                            </tbody>
                    </table>
                </div>

                <div id="log-content-area" class="interface-column content-area">
                    <h3 style="color: var(--color-accent-rose);">Contenu du Log S√©lectionn√©</h3>
                    
                    <p style="color: var(--color-text-light); border-bottom: 1px solid #303070; padding-bottom: 10px; margin-bottom: 15px;">
                        M√©thodes de cryptage potentielles : **ROT, C√©sar, Substitution, Inversion...**
                    </p>
                    
                    <pre id="encrypted-content-display">S√©lectionnez un log dans la liste pour afficher son contenu chiffr√©.</pre>
                    
                    <div class="decryption-tools">
                        <h4 style="color: var(--color-accent-bleu); margin-top: 20px; margin-bottom: 10px;">Outils d'analyse IA L.U.M.E.N.</h4>
                        <button class="decrypt-button" data-method="rot">ROT (Analyse par IA)</button>
                        <button class="decrypt-button" data-method="caesar">C√âSAR (D√©calage manuel)</button>
                        <button class="decrypt-button" data-method="inversion">INVERSION (Analyse invers√©e)</button>
                    </div>
                    
                    <p class="hint" id="decryption-hint">
                        **ATTENTION** : Le contenu est illisible √† premi√®re vue. Le d√©cryptage est manuel.
                    </p>
                </div>
            </div>
        </section>
    </div>

    <section id="flag-validation-challenge" style="display: none;">
        <h2 style="color: var(--color-accent-bleu);">Phase de R√©tablissement du R√©seau</h2>
        <p style="color: var(--color-text-light);">
            Fournissez le flag d√©couvert dans les logs pour d√©verrouiller les outils de restauration r√©seau.
        </p>

        <div id="validation-form-container">
            <label for="flag-input" style="color: var(--color-accent-rose); font-weight: bold; display: block; margin-bottom: 8px;">
                Saisir le Flag D√©crypt√© :
            </label>
            <input type="text" id="flag-input" placeholder="FLAG-XXXX-XXXX-X" required>
            
            <button id="validate-flag-btn">
                Valider et D√©verrouiller le R√©seau ‚û°Ô∏è
            </button>

            <p id="validation-message" style="margin-top: 15px; font-weight: bold;">
                </p>
        </div>
    </section>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            
            // --- Configuration Log API ---
            const apiEndpoint = 'http://localhost:3000/api/logs'; 
            const logsTableBody = document.getElementById('logs-table-body');
            const contentDisplay = document.getElementById('encrypted-content-display');

            // --- Configuration Validation Flag ---
            const flagInput = document.getElementById('flag-input');
            const validateButton = document.getElementById('validate-flag-btn');
            const messageDisplay = document.getElementById('validation-message');
            const EXPECTED_FLAG = "FLAG-LOGS-DECRYPT-6"; 
            
            // --- √âl√©ments de Navigation ---
            const sidebarLinks = document.querySelectorAll('#logs-sidebar a[data-target]');
            const logsSection = document.getElementById('log-decrypt-challenge');
            const validationSection = document.getElementById('flag-validation-challenge');
            const decryptionButtons = document.querySelectorAll('.decrypt-button');
            const decryptionHint = document.getElementById('decryption-hint');

            // ===================================
            // LOGIQUE 1 : CONSULTATION DES LOGS
            // ===================================

            function fetchLogs() {
                fetch(apiEndpoint)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`Erreur HTTP: ${response.status}`);
                        }
                        // Tentative de parsing du JSON
                        return response.json(); 
                    })
                    .then(logs => {
                        displayLogsList(logs);
                    })
                    .catch(error => {
                        console.error("Erreur de chargement de l'API des logs:", error);
                        // Affichage de l'erreur dans l'interface pour le joueur
                        contentDisplay.textContent = `√âchec de la connexion √† l'API: ${error.message}. V√©rifiez que 'logs_data.php' ne produit aucune sortie avant le JSON.`;
                        contentDisplay.style.color = 'var(--color-error)';
                    });
            }

            function displayLogsList(logs) {
                logsTableBody.innerHTML = ''; 
                logs.forEach(log => {
                    const row = logsTableBody.insertRow();
                    row.dataset.logId = log.id; 
                    
                    row.insertCell().textContent = log.id;
                    row.insertCell().textContent = log.timestamp.substring(11, 19); 
                    row.insertCell().textContent = log.type;

                    row.addEventListener('click', () => {
                        document.querySelectorAll('#logs-table-body tr').forEach(r => r.classList.remove('selected'));
                        row.classList.add('selected'); 
                        displayLogContent(log);
                    });
                });
            }

            function displayLogContent(log) {
                contentDisplay.textContent = log.encrypted_content;
                // R√©initialiser le message d'aide au d√©cryptage √† chaque nouveau log s√©lectionn√©
                decryptionHint.textContent = "**ATTENTION** : Le contenu est illisible √† premi√®re vue. Le d√©cryptage est manuel.";
                decryptionHint.style.color = 'var(--color-warning)';
            }


            // ===================================
            // LOGIQUE 2 : NAVIGATION SIDEBAR (√âpreuve 6 <-> √âpreuve 7)
            // ===================================
            sidebarLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault(); 
                    const targetId = link.getAttribute('data-target');
                    
                    // Masquer toutes les sections de contenu
                    logsSection.style.display = 'none';
                    validationSection.style.display = 'none';

                    // Afficher la section cible
                    if (targetId === 'log-display-area') {
                         logsSection.style.display = 'block';
                    } else if (targetId === 'flag-validation-challenge') {
                        validationSection.style.display = 'block';
                    }

                    // G√©rer la classe active
                    sidebarLinks.forEach(l => l.classList.remove('active-link'));
                    link.classList.add('active-link');
                });
            });


            // ===================================
            // LOGIQUE 3 : OUTILS DE D√âCRYPTAGE (Indices)
            // ===================================
            decryptionButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const method = button.getAttribute('data-method');
                    
                    if (contentDisplay.textContent.startsWith('S√©lectionnez')) {
                        decryptionHint.textContent = "‚ùå S√©lectionnez d'abord un log dans la liste centrale.";
                        decryptionHint.style.color = 'var(--color-error)';
                        return;
                    }

                    if (method === 'rot') {
                        // Simule l'√©chec tout en donnant l'indice '13'
                        decryptionHint.innerHTML = "‚úÖ **ANALYSE ROT** : L'outil d√©tecte un d√©calage de **13 positions** mais est corrompu et ne peut pas afficher le r√©sultat final. D√©cryptez manuellement !";
                        decryptionHint.style.color = 'var(--color-success)';
                    } else if (method === 'caesar') {
                        decryptionHint.innerHTML = "‚ö†Ô∏è **ANALYSE C√âSAR** : L'outil n√©cessite la cl√© de d√©calage (1 √† 25) pour fonctionner. Aucune cl√© trouv√©e.";
                        decryptionHint.style.color = 'var(--color-warning)';
                    } else if (method === 'inversion') {
                        decryptionHint.innerHTML = "‚ùå **ANALYSE INVERSION** : Le contenu n'est pas de l'inversion pure. √âchec.";
                        decryptionHint.style.color = 'var(--color-error)';
                    }
                });
            });


            // ===================================
            // LOGIQUE 4 : VALIDATION DU FLAG
            // ===================================
            validateButton.addEventListener('click', () => {
                const enteredFlag = flagInput.value.trim().toUpperCase(); 

                messageDisplay.className = '';

                if (enteredFlag === EXPECTED_FLAG) {
                    // Succ√®s
                    messageDisplay.classList.add('success');
                    messageDisplay.innerHTML = '‚úÖ **FLAG ACCEPT√â !** Outils de restauration r√©seau d√©verrouill√©s. Vous pouvez passer √† l\'√âpreuve 7.';
                    
                    validateButton.disabled = true;
                    flagInput.disabled = true;

                } else {
                    // Erreur
                    messageDisplay.classList.add('error');
                    messageDisplay.textContent = '‚ùå Flag incorrect. V√©rifiez attentivement votre d√©cryptage.';
                }
            });
            
            // --- D√âMARRAGE DE L'APPLICATION ---
            logsSection.style.display = 'block'; // Afficher la section des logs au d√©but
            fetchLogs();
        });
    </script>

</body>
</html>
